---
tags:
  - TODO
aliases:
  - vincoli di flusso
  - conservazione del flusso
  - ammissibilità del flusso
  - sbilanciamento
  - flusso
  - grafi residui
  - cammini aumentanti
  - ford fulkerson
  - edmonds karp
data: "`2025-03-05 09:13`"
---
- # Problema dei router:
	-  ![[problema dei router.excalidraw]]
	- Classico problema di minimizzazione del costo di flusso.
- # Intro:
	- Tutti i problemi sulle reti possono essere considerati come problemi di [[Programmazione lineare]].
	- Si lavora con dei [[Grafi#^792110| Grafi pesati]] $G=(N,A)$, di solito diretti, che rappresentano le _Reti_. 
	- Gli _archi_ sono interpretabili come i _canali_ in cui fluiscono gli oggetti, rappresentati con grandezze:
		- Discrete: come passeggeri o veicoli
		- Continue: fluidi
	- I _Nodi_ indicano i punti di ingresso o uscita dei suddetti oggetti 
- # Terminologia:
	- ## Sbilanciamento:
		- Ad ogni nodo $i\in N$ si associa un $b_{i}$ detto _sbilanciamento_ che può essere:
			- _positivo_:
				- Ovvero il nodo $i$ è di uscita ed è detto di _destinazione/pozzo_
				- $b_i$ è la _domanda_ di $i$
			- _negativo_:
				- Il nodo $i$ è di entrata ed è detto di _origine/sorgente_
				- $-b_{i}$ è l’_offerta_ di $i$
			- _nullo_:
				- Nodo $i$ è detto di _trasferimento_.
	- ## Archi:
		- Ad ogni arco $(i,j)\in A$ sono associati:
			- _Costo_:
				- il costo ($c_{ij}$) per un’oggetto per l’attraversamento del canale 
			- _Capacità inferiore_:
				- limite inferiore ($l_{ij}$) di quantità di oggetti che possono passare per un canale
			- _Capacità superiore_: 
				- limite superiore ($u_ij$) di quantità di oggetti che possono passare per un canale
		- ![[Pasted image 20250305094554.png|400]]
	- ## Flusso:
		- Assegnamento di valori reali agli archi di una certa rete $G=(N,A)$
		- Formalizzato tramite una sequenza di variabili $x_{ij}$ ed ognuno corrisponde ad un arco della rete.
		- _Costo_: costo complessivo di tutti i flussi presenti nella rete.
- # Vincoli:
	- ## Domanda e offerta globale si equivalgono:
		- $$\sum\limits_{i\in D}b_{i}= -\sum\limits_{i\in O}b_{i}\iff \sum\limits_{i\in N}b_{i}=0$$
			- $D=\{i \in N | b_{i} >0\}$ e $O=\{i \in N| b_{i}<0\}$
	- ## Conservazione del flusso:
		- $$\sum\limits_{(i,j)\in BS(i)}x_{ij}-\sum\limits_{(i,j)\in FS(i)}x_{ij}=b_{i}\ \ \ \ \ \forall i \in N$$
			- Ovvero ciò che entra in un nodo è uguale a ciò che esce meno lo sbilanciamento.
			- $BS(i)=\{(k,i)|(k,i)\in A\}$ insieme degli archi entranti in $i$
			- $FS(i)= \{(i,k)|(i,k)\in A\}$ insieme degli archi uscenti da $i$
	- ## Ammissibilità del flusso:
		- $$l_{ij}\le x_{ij} \le u_{ij}\ \ \ (i,j)\in A$$
- # Problemi di flusso:
	- Rappresentano un compromesso tra:
		- ___Complessità___:
			- visto che esistono vari algoritmi efficienti per risolverli anche per i più generali 
		- ___Espressività___: 
			- molti problemi generici si possono esprime come istanze di problemi di flusso.
	- Spesso si fanno ipotesi semplificative, come imporre $l_{ij}=0$ per ogni arco, quindi le _capacità inferiori_ sono sempre nulle.
		- Spesso fare questa ipotesi non cambia l’espressività del problema 
		- ## ES:
			- Trasformare una rete $G$ in una equivalente $H$ con le capacità inferiori nulle
			- Si sottrae $l_{ij}$ a $b_{j}$ e a $u_{ij}$
			- Si aggiunge $l_{ij}$ a $b_{j}$ 
			- Si aggiunge la seguente quantità alla [[Programmazione lineare intera (PLI)#^fbc927|funzione obiettivo]]:
				- $$\sum\limits_{(i,j)\in A}c_{ij}*l_{ij}$$
			- Quindi il flusso $x_{ij}$ in $G$ corrisponde a $x_{ij}+l_{ij}$ in $H$
- # Problema di flusso di costo minimo (MCF):
	- _Minimum cost flow_:
	- Il costo del flusso è la funzione obiettivo.
	- $l_{ij}=0 \ \ \ \forall (i,j)\in A$
	- Esprimibile come problema di [[Programmazione lineare]]:
		- $$\min cx$$
		- $$0\le x\le u\ \ \ \ Ex=b$$
		- Dove:
			- $c\in \mathbb{R}^{|A|}$ è il vettore dei costi.
			- $u\in \mathbb{R}^{|A|}$ vettore delle capacità superiori.
			- $E in \mathbb{R}^{|N|\times|A|}$ matrice di incidenza tra nodi ed archi.
			- $b$ vettore di sbilanciamenti
	- Spesso si assume che ci sia una sola _sorgente_ e un solo _pozzo_
		- Si aggiungono 2 nodi finti corrispondenti a 1 sorgente e 1 pozzo rispettivamente.
		- Si aggiungono archi finti dalla sorgente ad ogni sorgente di partenza. Ogni arco aggiunto avrà _costo nullo_, e capacità superiore pari all’_inverso dello sbilanciamento della sorgente_
			- Cosa analoga si fa con il nodo _pozzo_
		- Lo sbilanciamento della nuova _sorgente_ è la somma degli sbilanciamenti delle sorgenti di partenza. Cosa simile per i pozzi.
	- Si assume spesso anche che ogni nodo abbia una _capacità_, ovvero che solo una quantità $\in [l_{ij},u_{ij}]$ possa passare per il nodo $i$
		- Modellabile grazie allo _sdoppiamento_ di ciascun nodo $i$ in $i',i''$:
			- Tutti gli archi $(k,i)$ entreranno in $i'$
			- Tutti gli archi $(i,k)$ partiranno invece da $i''$
			- Si crea un arco fittizio $(i′, i′′)$ con costo nullo, capacità Inferiore $l_{i}$ e capacità superiore $u_{i}$
- # problema di flusso massimo (MF):
	- Maximum flow. 
	- Cambia la funzione obiettivo, nella quale si vogliono massimizzare i flussi.
	- Può essere inteso come un particolare MCF in quanto i parametri sono diventati variabili.
		- I costi sono nulli.
		- Gli sbilanciamenti sono nulli
		- Si aggiunge però un arco fittizio da ($t,  s$) con costo $−1$ e Capacità $\infty$.
		- ![[Pasted image 20250305102744.png|450]]
	- 
	- ## Algoritmi:
		- ### Tagli:
			- Data una rete $G=(N,A)$ e una coppia $(N',N'')$ di sottoinsiemi di $N$ tali che $N' \cap N''=\emptyset$ e $N' \cup N''=N$
			- Un $(s,t)$ _-taglio_ è un tipo di taglio $(N_{s},N_{t})$ dove $s\in N_{s}\wedge t\in N_{t}$ 
			- Dato un $(s,t)$ -taglio di un grafo $G$ si indica con $A^{+}(N_{s},N_{t})$ e $A^{-}(N_{s},N_{t})$ i seguenti sottoinsiemi:
				- $$A^{+}(N_{s},N_{t})=\{(i,j)\in A|i\in N_{s}\wedge j\in N_{t}\}$$
				- $$A^{-}(N_{s},N_{t})=\{(i,j)\in A|j\in N_{s}\wedge i\in N_{t}\}$$
			- #### Lemma:
				- $\forall(s,t)$ -taglio e ogni flusso ammissibile $x$ con valore $v$:
					- 1) $$v=\sum\limits_{(i,j)\in A^{+}(N_{s},N_{t})}x_{ij} - \sum\limits_{(i,j)\in A^{-}(N_{s},N_{t})}x_{ij}$$
						- Questo è il flusso del taglio
					- 2) $$v\le \sum\limits_{(i,j)\in A^{+}(N_{s},N_{t})}u_{ij} $$
						- Vuol dire che il flusso del taglio deve essere $\le$ della capacità del taglio.
				- _Esiste un taglio con flusso ammissibile uguale al flusso massimo?_
			- #### ES:
				- Si vuole trasportare il massimo flusso dal nodo $s$ a $t$ avendo in mezzo altri 4 nodi di trasferimento
					- #inserire_immagine
				- Calcolo della capacità massima del taglio fatto:
					- _Da fare _
				- Calcolo del flusso del taglio fatto:
					- $$x(N_{s},N_{t})=3+2+1+1-1=6$$
					- Basta guardare il lemma 1 per questo.
		- ### Grafi residui:
			- Data una rete $G=(N_{G}, A_{G})$ supponendo di avere un flusso ammissibile $x$ si prova a creare un altro grafo detto _grafo residuo_ $G_{x}=(N_{G_{x}}, A_{G_{x}})$ che può essere migliorato.
			- $N_{G_{x}}=N_{G}$
			- Gli archi $A_{G_{x}}$ sono di 2 tipi:
				- _arco concorde_: $(i,j)\in A_{G}: x_{ij}<u_{ij}$  esiste un arco da $i$ a $j$ in $G_{x}$ 
				- _arco discorde_: $(i,j)\in A_{G}: x_{ij}>0$  esiste un arco da $j$ a $i$ in $G_{x}$
			- Ci possono essere più nodi che partono dallo stesso nodo e arrivano allo stesso nodo rispetto a $G$ per questo è detto _multi-grafo_
			- Quindi si aumentano in modo uniforme i flussi senza sbilanciare i nodi
			- #### ES:
		- ### Cammini aumentanti:
			- Un cammino semplice (_senza cicli_) e orientato da $s$ a $t$ nel grafo residuo $G_{x}$ questo cammino è identificato da un insieme di archi concordi $P^{+}$ e di archi discordi $P^{-}$.
			- Dato un cammino aumentante si calcola di quanto può aumentare il flusso 
				- $$\theta(P,x)=\min \{\min\{u_{ij}-x_{ij}| (i,j)\in P^{+} \}, \min\{x_{ij}|(j,i)\in P^{-}\}\}$$
			- Dato un flusso $x$ un cammino $P\in G_{x}$ e un $\theta$ si definisce $x(P,\theta)$ il flusso:
				- $$(x(P,\theta))_{i,j}=\begin{cases} x_{i,j}+\theta&(i,j)\in P^{+}\\ x_{i,j}-\theta&(j,i)\in P^{-}\\ x_{ij}&altrimenti\end{cases}$$
		- ### Algoritmo di Ford-Fulkerson:
			- 1)  $x=0$
			- 2) Si costruisce $G_{x}$ e si cerca un cammino aumentante $P$ in caso $P$ non esista termina e restituisce $x$
			- 3)  $x=x(P,\theta(P,x))$
			- 4) ritorna al secondo punto
			- #### Correttezza:
				- 1) Se $x$ è un flusso ammissibile allora anche $x(P,\theta(P,x))$ lo è.
				- 2) Se $x$ è un flusso massimo allora non esiste alcun cammino aumentante.
					- Infatti se ci fosse un cammino aumentante in $G_{x}$ allora $x$ non sarebbe un flusso massimo perché si potrebbe aumentare il flusso.
				- 3) se $G_{x}$ non ha cammini aumentanti allora esiste un taglio di capacità pari a $v$:
					- Basta considerare il taglio $(N_{s},N_{t})$ dove $N_{s}$ contiene tutti i nodi raggiungibili da $s$ in $G_{x}$ e $N_{t}$ è il suo complementare:
						- $$v= x(N_{s},N_{t})=\sum\limits_{(i,j)\in A^{+}(N_{s},N_{t})}x_{ij} - \sum\limits_{(i,j)\in A^{-}(N_{s},N_{t})}x_{ij}=$$
						- $$\sum\limits_{(i,j)\in A^{+}(N_{s},N_{t})}u_{ij} - \sum\limits_{(i,j)\in A^{-}(N_{s},N_{t})}u= u(N_{s},N_{t})$$
				- ##### Teorema:
					- Se l’algoritmo termina allora il flusso $x$ restituito è massimo.
				- ##### Dim:
					- Se l’algoritmo termina allora $G_{x}$ non ha cammini aumentanti.
					- Per il punto 3 allora esiste un taglio $(N_{s},N_{t})$ di capacità $v$.
					- Quindi $v$ deve essere massimo perché se non lo fosse avremmo un taglio di capacità inferiore al valore di un flusso ammissibile.
			- #### Max flow min cut:
				- Il valore del massimo flusso è uguale alla minima capacità dei tagli:
					- 
					- Se $x$ è ammissibile e massimo allora $G_{x}$ non ha cammini aumentanti e quindi esiste un taglio con capacità pari a $v$ per il punto 3.
			- #### Complessità:
				- Se le capacità di $G$ sono numeri interi allora esiste un flusso intero massimo.
				- ##### Dim :
					- Se le capacità sono intere allora il flusso massimo sarà al più:
						- $$nU$$
						- Dove $n$ è il numero di nodi e  $U$ è il massimo valore di capacità
					- Si parte da un flusso intero e l’interezza è preservata perché per ogni cammino aumentante $P,\theta(P,x)$ è un numero intero.
					- Quindi ad ogni iterata il flusso aumenta di almeno 1.
					- L’algoritmo termina quindi dopo al più $nU$ iterazioni.
				- Il problema dell’algoritmo sta nell’assenza di vincoli sulla scelta dei cammini da aumentare.
		- ### Algoritmo di Edmonds-Karp:
			- è una modifica dell’algoritmo di Ford-Fulkerson ma si mette un criterio sulla scelta dei cammini da aumentare.
				- Si modifica il punto 2 di quell’algoritmo Utilizzando una visita [[Visite sui Grafi#^3c4eb5|BFS]] sul grafo $G_{x}$ in questo modo si nota come verranno scelti sempre i cammini con meno archi quindi più corti.
			- #### Proprietà:
				- L’algoritmo è corretto siccome è solo una istanza particolare di Ford-fulkerson.
				- Si indica con $\delta_{x}(i,j)$ la distanza tra $i$ e $j$ nel grafo residuo $G_{x}$ 
				- ##### lemma:
					- Se durante EK il flusso $y$ è ottenuto da $x$ con un aumento di flusso in un cammino aumentante, allora $\forall i\in N$ vale che:
						- $$\delta_{x}(s,i)\le \delta_{y}(s,i)$$
			- #### Complessità:
				- Si osserva che in FF i cammini aumentanti sono di _lunghezza minima_ allora la distanza di un nodo dalla sorgente $s$ in $G_{x}$ _non può diminuire_.
				- Da ciò si deduce come il numero di iterazioni in questo algoritmo non può essere maggiore di $N*A$ 
			- #### Teorema :
				- Le iterazioni di EK è $O(N*A)$ quindi la complessità sarà $O(N*A^{2})$ 
			- #### Dim:
				- ##### Arco critico:
					- Un arco critico è un arco che dice quale sia la capacità residua dell’arco quindi la sua capacità è uguale a $\theta(P,x)$ dove $P$ è il cammino aumentante.
						- Dopo l’aumento del flusso in $P$ l’arco critico _sparisce_ dal grafo residuo.
						- In ogni cammino aumentante esiste almeno un _arco critico_
				- Quante volte è possibile che dati $i$ e $j$ connessi da un arco esso sia critico?
					- Si dimostra che quel numero è $O(N)$ e visto che tali coppie sono al più $O(A)$ in totale si avranno al più $O(N*A)$ iterazioni.
				- Quando $(i,j)$ diventa critico per la prima volta deve valere che:
					- $$\delta_{x}(s,j)=\delta_{x}(s,i)+1$$
					- Ciò vale perché il cammino da $s$ a $i$ è già minimo allora per arrivare da $s$ a $j$ sarà uguale a quello prima più un altro passo.
					- Il flusso $x$ a quel punto sparisce dal grafo residuo.
				- Se si vuole far ricomparire l’arco critico si deve fare in modo che il flusso da $i$ a $j$ diminuisca ovvero:
					- $$\delta_{y}(s,i)=\delta_{y}(s,j)+1$$
				- E quindi :
					- $$\delta_{y}(s,i)=\delta_{y}(s,j)+1 \ge \delta_{x}(s,j)+1 = \delta_{x}(s,i)+2$$
				- Di conseguenza da quando $(i,j)$ diventa critico al successivo la sua distanza da $s$ aumenta di almeno 2 e siccome la distanza non può essere $\ge$ al numero di nodi $|N|$ quindi quell’arco può diventare critico al massimo $|N|$ volte 
				- _tutto ciò vale solo perché si sta usando una BFS avendo quindi i cammini di lunghezza minima_.
		- ### Goldberg-Tarjan:
			- Costruisce il flusso massimo locale, a differenza dei due precedenti. 
			- Si decide quindi di cambiare il flusso solo in certe porzioni del grafo.
			- Non si lavora solo con flussi ammissibili, ma anche con dei _preflussi_
				- Che sono più generali, sono dei vettori $x$ tali che:
					- $$\sum\limits_{(j,i)\in BS(i)} x_{ij}-\sum\limits_{(j,i)\in FS(i)} x_{ij}\ge 0\ \ \ \ i\in  N-\{s,t\}$$
			- Un nodo si dice _attivo_ se il suo _eccesso_:
				- $$e_{i}=\sum\limits_{(j,i)\in BS(i)} x_{ij}-\sum\limits_{(j,i)\in FS(i)} x_{ij}$$
					- è bilanciato 
			- L’idea quindi è di eliminare gli sbilanciamenti e di “disattivare” i nodi attivi
			- Per eliminare lo sbilanciamento di un nodo $i$ si sposta parte del flusso in eccesso:
				- In avanti attraverso $(i,j)$ se
				- Indietro attraverso $(j,i)$ se $x_{ij}>0$
				- Chiamate operazioni di _push forward_ e _push backwards_
			- Per capire se quste operazioni sono possibili si usano delle “etichette”
			- ![[Pasted image 20250319101053.png|400]]
			- #### EtichettaturaVALIDA (G):
				- $d_{i}=$ lunghezza del cammino minimo da $i$ a $t$ 
			- #### PushForward(v, j):
				- Aumento il flusso da $i$ a $j$ di 
				- $x_{ij}=x_{ij}+\min\{u_{vj}-x_{vj},e_{v}\}$
			- #### PushBackward(i, v):
				- $x_{iv}=$
			- #### Relabel(v):
				- Cambia l’altezza del nodo $v$ per rendere possibile almeno una delle due operazioni di _push_.
- # Problema di flusso di costo minimo:
	- ## Pseudoflusso:
		- Vettore che soddisfa i vincoli:
			- $$0\le x_{ij}\le u_{ij}\ \ \ (i,j)\in A$$
	- ## Sbilanciamento:
		- Se $x$ è uno pseudoflusso lo sbilanciamento di un nodo $i$ rispetto al flusso $x$ è:
			- $$e_{x}(i)=\sum\limits_{(j,i)\in BS(i)} x_{ij} \ -\sum\limits_{(i,j)\in FS(i)} x_{ij}-b_{i}$$
			- $e_{x}$ è anche detto vettore degli sbilanciamenti.
			- E l’obiettivo è eliminare i valori diversi da 0 in questo vettore.
	- ## Nodi offerta e domanda:
		- Dato uno pseudoflusso $x$ :
			- $$O_{x}=\{i\in N|e_{x}(i)>0\}$$
				- Detti nodi con _eccesso di flusso_
			- $$D_{x}=\{i\in N|e_{x}(i)<0\}$$
				- Nodi con _difetto di flusso_
			- Se $O_{x}=D_{x}=\emptyset$ allora tutti i nodi hanno $e_{x}(i)=0$ quindi $x$ è un flusso.
	- ## Sbilanciamento complessivo:
		- $$g(x)=\sum\limits_{i\in O_{x}}e_{x}(i)= -\sum\limits_{j\in D_{x}}e_{x}(j)$$
	- ## Cammini aumentanti:
		- Questa definizione diventa più generale con questo problema.
		- In più gli archi concordi e discordi avranno un costo.
		- Quindi ogni cammino aumentante avrà un costo che è dato dalla somma dei costi degli archi che lo compongono:
			- $$c(P)=\sum\limits_{(i,j)\in P^{+}} c_{ij} -\sum\limits_{(i,j)\in P^{-}} c_{ij}$$
				- Dove $c_{ij}$ è il costo dell’ arco $(i,j)$
	- ## Cammini minimi successivi:
		- ![[Pasted image 20250319104138.png|625]]
		- ### Pseudoflusso minimale:
			- è _minimale_ se ha costo minimo tra tutti gli pseudoflussi che danno luogo allo stesso vettore di sbilanciamento $e(x)$.
			- #### Lemma:
				- Uno pseudoflusso è minimale $\iff$ non esistono cicli aumentanti di valore negativo.
				- $\implies$)
					- Se esistesse un ciclo aumentante di valore negativo allora si potrebbe diminuire il costo dello pseudoflusso senza alterare lo sbilanciamento, in contraddizione con la minimalità di $x$
				- $\Longleftarrow$) 
					- Suppongo che $x$ non sia minimale che quindi esista $y: c_{y}<c_{x}$ e $e_{y}=e_{x}$ allora per il teorema degli pseudoflussi che permette di scrivere y come:
						- $$y=x ⊕ θ_{1}P_{1} ⊕ . . . ⊕ θ_{n}P_{n}$$
						- $\theta_{i}>0$ e ogni $P_{i}$ è un ciclo
						- 
				- 
- # Link Utili:  
	- 